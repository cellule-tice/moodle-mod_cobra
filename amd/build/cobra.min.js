define("mod_cobra/cobra",["jquery","core/log","core/ajax","core/templates","core/notification"],(function($,log,ajax,templates,notification){var jsonparams,objparams,glossaryentries;return{initUi:function(){$("body").hasClass("drawer-open-left")&&($("body").removeClass("drawer-open-left"),$("#nav-drawer").attr("aria-hidden","true"),$("#nav-drawer").addClass("closed"),$('button[aria-controls="nav-drawer"]').trigger("click"))},initData:function(args){jsonparams=args,objparams=JSON.parse(jsonparams)},modFormTriggers:function(){var langbutton=$("#id_updatelanguage"),langselect=$("#id_language"),corpusorder=$("#id_corpusorder"),collbutton=$("#id_selectcollection"),collselect=$("#id_collection"),textselect=$("#id_text"),textlocalname=$("#id_name");langselect.on("change",(function(){var lang=langselect.find("option:selected").text();"EN"==lang?corpusorder.val(objparams.en):"NL"==lang&&corpusorder.val(objparams.nl),langbutton.trigger("click")})),collselect.on("change",(function(){collbutton.trigger("click")})),textselect.on("change",(function(){""==textlocalname.val()&&textlocalname.val($("#id_text :selected").text())}))},entryOnClick:function(){$(".lemma").on("click",(function(){$(".clicked").removeClass("clicked"),$(".emphasize").removeClass("emphasize");var conceptId=$(this).attr("name");$(".lemma[name="+conceptId+"]").addClass("emphasize"),$(this).removeClass("emphasize"),$(this).addClass("clicked"),displayDetails(conceptId,!1)})),$(".expression").on("click",(function(){$(".clicked").removeClass("clicked"),$(".emphasize").removeClass("emphasize");var conceptId=$(this).attr("name");$(".expression[name="+conceptId+"]").addClass("emphasize"),$(this).prevAll("span.expression").each((function(){return $(this).attr("name")==conceptId&&($(this).removeClass("emphasize"),$(this).addClass("clicked"),!0)})),$(this).nextAll("span.expression").each((function(){return $(this).attr("name")==conceptId&&($(this).removeClass("emphasize"),$(this).addClass("clicked"),!0)})),$(this).removeClass("emphasize"),$(this).addClass("clicked"),displayDetails(conceptId,!0)}))},concordanceOnClick:function(){$("#details").on("click",".cc_source",(function(){var quickindexitem,fullConcordanceDiv,idConcordance;quickindexitem=$(this),fullConcordanceDiv=$("#full_concordance"),idConcordance=quickindexitem.attr("name"),ajax.call([{methodname:"mod_cobra_get_full_concordance",args:{idconcordance:idConcordance}}])[0].done((function(response){"bilingual"==objparams.examples&&(response.bilingual=!0),templates.render("mod_cobra/fullconcordance",response).done((function(html){fullConcordanceDiv.html(html),fullConcordanceDiv.removeClass(),fullConcordanceDiv.addClass(response.type),fullConcordanceDiv.show()})).fail(notification.exception)})).fail(notification.exception)}))},textGlossaryActions:function(){ajax.call([{methodname:"mod_cobra_load_glossary",args:{textid:objparams.text,courseid:objparams.course,userid:objparams.user}}])[0].done((function(response){glossaryentries=response,updateglossarydisplay()})).fail(notification.exception),$("#details").on("click",".glossaryaddbutton",(function(){var lingEntity=$(this).prev().text();ajax.call([{methodname:"mod_cobra_add_to_glossary",args:{lingentity:lingEntity,textid:objparams.text,course:objparams.course,userid:objparams.user}}])[0].done((function(response){glossaryentries.push(response),glossaryentries.sort((function(a,b){return a.entry.toLowerCase()<b.entry.toLowerCase()?-1:a.entry.toLowerCase()>b.entry.toLowerCase()?1:0}));var datafortpl=new Array;datafortpl.lingentity=lingEntity,datafortpl.iconclass="inglossary",datafortpl.add=!1,templates.render("mod_cobra/glossaryiconcell",datafortpl).done((function(html){$(".digest-row").find("button.glossaryaddbutton").replaceWith(html)})).fail(notification.exception),updateglossarydisplay()})).fail(notification.exception)})),$("#myglossary").on("click",".glossaryremovebutton",(function(){var lingEntity=$(this).prev().text();ajax.call([{methodname:"mod_cobra_remove_from_glossary",args:{lingentity:lingEntity,course:objparams.course,userid:objparams.user}}])[0].done((function(response){if(glossaryentries.forEach((function(result,index){parseInt(result.lingentity)===response.lingentity&&glossaryentries.splice(index,1)})),$(".digest-row").find("span:first").text()==lingEntity){var datafortpl=new Array;datafortpl.lingentity=lingEntity,datafortpl.iconclass="glossaryadd",datafortpl.add=!0,templates.render("mod_cobra/glossaryiconcell",datafortpl).done((function(html){$(".digest-row").find("img:first").replaceWith('<button class="glossaryaddbutton">'.concat(html,"</button>"))})).fail(notification.exception)}updateglossarydisplay()})).fail(notification.exception)}))},myGlossaryActions:function(){$("#myglossary").on("click",".glossaryremove",(function(){var lingEntity=$(this).find("span:first").text(),currentElement=$(this);ajax.call([{methodname:"mod_cobra_remove_from_glossary",args:{lingentity:lingEntity,course:objparams.course,userid:objparams.user}}])[0].done((function(response){response.lingentity==lingEntity&&$(currentElement).hasClass("inDisplay")&&$(currentElement.parent().remove())})).fail(notification.exception)}))},demoapikey:function(){$("#requestapikey").on("click",(function(){ajax.call([{methodname:"mod_cobra_get_demo_api_key",args:{}}])[0].done((function(response){$("#id_s_mod_cobra_apikey").val(response.apikey)})).fail(notification.exception),$(this).prop("disabled",!0)}))}};function displayDetails(conceptId,isExpression){$("#full_concordance").hide(),ajax.call([{methodname:"mod_cobra_get_entry",args:{conceptid:conceptId,isexpr:isExpression,params:jsonparams}}])[0].done((function(response){"bilingual"==objparams.examples&&(response.bilingual=!0),templates.render("mod_cobra/entrydetails",response).done((function(html){$("#details").html(html)})).fail(notification.exception)})).fail(notification.exception)}function updateglossarydisplay(){var datafortpl=new Array;datafortpl.entries=glossaryentries,datafortpl.cmid=objparams.cmid,datafortpl.course=objparams.course,templates.render("mod_cobra/intextglossary",datafortpl).done((function(html){$("#glossary").replaceWith(html),$("#glossary").css("height",$("#cobratext").css("height"))})).fail(notification.exception)}}));

//# sourceMappingURL=cobra.min.js.map